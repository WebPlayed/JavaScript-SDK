/*! JavaScript-SDK v1.0.0 - 2015-04-06 
 *  License: GNU v2 */

!function(a){"use strict";function b(){}function c(a){e=a.source,d.isAlive=!0,d.onAliveCallback()}b.prototype.namespace="",b.prototype.apiKey="",b.prototype.host="{{DOMAIN}}",b.prototype.appQuery="",b.prototype.asyncRequests=!0,b.prototype.driveCallback=null,b.prototype.onReady=null,b.prototype.isAlive=!1,b.prototype.onAliveCallback=null,b.prototype.helpers={},b.prototype.modules={},b.prototype.components={};var d=new b;b.prototype.components.autoSdk={execute:function(){var a=JSON.parse(d.api("/DataSync","GET",{}));for(var b in a)a.hasOwnProperty(b)&&localStorage.setItem(a[b].variable,a[b].value);var c=localStorage.setItem;localStorage.setItem=function(a,b){c.apply(this,arguments),d.asyncRequests=!0,d.components.autoSdk.isJSON(b)?d.api("/JsonSync","POST",{variable:a,value:b},function(){}):d.api("/DataSync","POST",{variable:a,value:b},function(){})};var e=localStorage.removeItem;localStorage.removeItem=function(a){return d.asyncRequests=!1,d.api("/DataSync/"+a,"DELETE",{}),e.apply(this,arguments)};var f=document.getElementsByTagName("head")[0],g=document.createElement("meta");g.name="mobile-web-app-capable",g.content="yes";var h=document.createElement("meta");h.name="apple-mobile-web-app-capable",h.content="yes";var i=document.createElement("meta");i.name="apple-mobile-web-app-status-bar-style",i.content="black",d.asyncRequests=!1;var j=JSON.parse(d.api("/Store/"+d.namespace,"GET",{}));d.asyncRequests=!0;var k=document.createElement("meta");k.name="apple-mobile-web-app-title",k.content=j.title;var l=document.createElement("link");l.href=j.icon,l.rel="apple-touch-icon",f.appendChild(k),f.appendChild(l),f.appendChild(g),f.appendChild(h),f.appendChild(i)},isJSON:function(a){try{JSON.parse(a)}catch(b){return!1}return!0}},b.prototype.components.clouddrive={upload:function(a,b,c,e){var f,g=new FormData,h=new XMLHttpRequest;for(f=0;f<c.length;f++)g.append("files[]",c[f]);var i=d.helpers.cookie.get("access_token_"+d.namespace);h.onload=function(){e(h.responseText)},h.open(b,this.host+"api"+a+"?access_token="+i),h.send(g)},openDialog:function(b){d.driveCallback=b,a.open(d.host+"dialog/drive","Choose a file","height=400,width=600")}},b.prototype.components.navigation={show:function(){e.postMessage("navigation.show","*")},hide:function(){e.postMessage("navigation.hide","*")}},b.prototype.components.purchase={makePurchase:function(b,c,e){var f,g=new d.components.purchase.purchaseResponse,h={success:c,cancel:e};a.purchaseUpdate=function(){if(a.purchaseWindow.closed){if(a.clearInterval(f),"undefined"!=typeof g&&null!==g.approved)return"true"===g.approved?void h.success():void h.cancel();h.cancel()}else{var b=a.purchaseWindow.document.URL,c=b.split("?"),d=c[1];if("undefined"!=typeof d)for(var e=d.split("&"),i=0;i<e.length;i++){var j=e[i].split("=");g[j[0]]=j[1]}"undefined"!=typeof g&&null!==g.approved&&setTimeout(function(){a.purchaseWindow.close()},1500)}},a.purchaseWindow=a.open(d.host+"purchase/"+d.namespace+"/"+b,"In App Purchase","height=800,width=1024"),f=a.setInterval(a.purchaseUpdate,500)},purchaseResponse:function(){this.approved=null}},b.prototype.helpers.cookie={get:function(a){var b="; "+document.cookie,c=b.split("; "+a+"=");return 2===c.length?c.pop().split(";").shift():void 0},set:function(a,b,c){var d="";c&&(d="; max-age="+c/1e3),document.cookie=a+"="+b+d+"; path=/"}},b.prototype.helpers.http={ajax:function(){}};var e=null;b.prototype.helpers.url={getHashValue:function(a){return location.hash.match(new RegExp(a+"=([^&]*)"))[1]},getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},objToQuery:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}},b.prototype.api=function(b,c,e,f){var g,h=d.appQuery,i=this.host+"api"+b;return g=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.asyncRequests===!0&&(g.onreadystatechange=function(){4===g.readyState&&f(g)}),e=d.helpers.url.objToQuery(e),e&&(h=h+"&"+e),("GET"===c||"DELETE"===c)&&(i=i+"?"+h),g.open(c,i,d.asyncRequests),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(h),d.asyncRequests===!1?g.responseText:void 0},b.prototype.init=function(a){a.async&&(d.asyncRequests=a.async),d.namespace=a.namespace,"undefined"!=typeof a.ready&&(d.onReady=a.ready),d.modules.authenticate.isAuthenticated()?(d.appQuery=d.helpers.url.objToQuery({access_token:d.helpers.cookie.get("wbp_access_token_"+d.namespace)}),null!==d.onReady&&d.onReady()):d.modules.authenticate.startAuthenticate(a.popup,a.redirectUri),a.auto===!0&&(d.asyncRequests=!1,d.components.autoSdk.execute())},b.prototype.onAlive=function(b){d.onAliveCallback=b,a.addEventListener("message",c,!1)},b.prototype.modules.authenticate={isAuthenticated:function(){var b=d.helpers.cookie.get("wbp_access_token_"+d.namespace);return""!==a.location.hash?(d.helpers.cookie.set("wbp_access_token_"+d.namespace,d.helpers.url.getHashValue("access_token"),d.helpers.url.getHashValue("expires_in")),!0):null===b||"undefined"==typeof b?!1:!0},startAuthenticate:function(b){var c=d.host+"oauth2/authorize?response_type=token&client_id="+d.namespace+"&state=xys";if(c+="&access_token="+d.helpers.url.getParameterByName("server_token"),b){var e=new d.modules.authenticate.authenticateResponse;a.hashUpdate=function(){if(a.loginWindow.closed)a.clearInterval(intervalId),d.helpers.cookie.set("wbp_access_token_"+d.namespace,e.access_token,e.expires_in),d.appQuery=d.helpers.url.objToQuery({access_token:e.access_token}),null!==d.onReady&&d.onReady();else{var b=a.loginWindow.document.URL,c=b.split("#"),f=c[1];if("undefined"!=typeof f){for(var g=f.split("&"),h=0;h<g.length;h++){var i=g[h].split("=");e[i[0]]=i[1]}setTimeout(function(){a.loginWindow.close()},1500)}}},a.loginWindow=a.open(c,"Authenticate Permissions",!1),intervalId=a.setInterval(a.hashUpdate,500)}else a.location.href=c},authenticateResponse:function(){this.access_token=null,this.expires_in=null}},a.WBP=d}(window);
//# sourceMappingURL=JavaScript-SDK-v1.0.0.min.js.map